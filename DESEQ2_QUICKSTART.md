# DESeq2 Quick Reference Card

## What You Need

**ONLY ONE FILE**: `metadata.csv`

Everything else (counts, BAM files) is already generated by previous pipeline stages.

---

## Demo Metadata (Copy & Use!)

**File provided**: `/home/vth3bk/Pipelinin/ExpressDiff/demo_metadata.csv`

```csv
sample_name,condition
control_1,control
control_2,control
control_3,control
treatment_1,treatment
treatment_2,treatment
treatment_3,treatment
```

---

## Upload in 3 Commands

```bash
# 1. Set your run ID
RUN_ID="paste-your-run-id-here"

# 2. Create metadata directory
mkdir -p /scratch/vth3bk/ExpressDiff/runs/${RUN_ID}/metadata

# 3. Copy demo metadata
cp /home/vth3bk/Pipelinin/ExpressDiff/demo_metadata.csv \
   /scratch/vth3bk/ExpressDiff/runs/${RUN_ID}/metadata/metadata.csv
```

**That's it!** Now go to UI → Pipeline → DESeq2 Analysis → Run

---

## OR: Use the Helper Script

```bash
cd /home/vth3bk/Pipelinin/ExpressDiff
./create_demo_metadata.sh
# Enter your run ID when prompted
```

---

## For Custom Data

1. **Find your sample names**:
   ```bash
   ls /scratch/vth3bk/ExpressDiff/runs/RUN_ID/star/*.bam | \
     xargs -n1 basename | sed 's/_Aligned.sortedByCoord.out.bam//'
   ```

2. **Create metadata** with those exact names:
   ```csv
   sample_name,condition
   your_actual_sample_name_1,control
   your_actual_sample_name_2,treatment
   ```

3. **Save as**: `/scratch/vth3bk/ExpressDiff/runs/RUN_ID/metadata/metadata.csv`

---

## Validation

```bash
# Check metadata exists and looks correct
cat /scratch/vth3bk/ExpressDiff/runs/${RUN_ID}/metadata/metadata.csv

# Should show:
# - Header: sample_name,condition
# - One line per sample
# - At least 2 different conditions
```

---

## What Happens Next

After uploading metadata → Run DESeq2 from UI:

1. **Input**: 
   - `counts.txt` (from featureCounts)
   - `metadata.csv` (you just created)

2. **Output** (in `/scratch/.../runs/RUN_ID/deseq2/`):
   - `full_results.csv` - All genes with stats
   - `significant_degs.csv` - Filtered DEGs
   - `top_degs.csv` - Top 50 genes
   - `summary.txt` - Statistics

3. **Time**: ~5-10 minutes for demo data

---

## Common Issues

| Problem | Solution |
|---------|----------|
| "Metadata not found" | Check file location and name |
| "Sample names don't match" | Use exact names from BAM files |
| "Not enough conditions" | Need ≥2 different conditions |
| File won't parse | Ensure CSV format, no extra spaces |

---

## Full Documentation

- **`METADATA_CSV_GUIDE.md`** - Complete guide with examples
- **`TEST_DESEQ2.md`** - Full testing walkthrough
- **`demo_metadata.csv`** - Ready-to-use file

---

## TL;DR

```bash
# Copy this entire block and run it:
RUN_ID="YOUR_RUN_ID_HERE"  # ← CHANGE THIS!
mkdir -p /scratch/vth3bk/ExpressDiff/runs/${RUN_ID}/metadata
cp /home/vth3bk/Pipelinin/ExpressDiff/demo_metadata.csv \
   /scratch/vth3bk/ExpressDiff/runs/${RUN_ID}/metadata/metadata.csv
echo "✓ Metadata ready! Go to UI → Pipeline → DESeq2 Analysis → Run"
```
